<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>File Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

    <script th:inline="javascript">
        function deleteFile(button) {
            const filename = button.getAttribute("data-nama");
            if (confirm('Yakin ingin menghapus "' + filename + '"?')) {

                fetch('/files/delete/' + filename, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            location.reload();
                            alert("File "+ filename + " berhasil dihapus !");
                        } else {
                            alert('Gagal menghapus file');
                        }
                    })
                    .catch(err => {
                      	alert("Error: " + err.message);
                    });
            }
        }
    </script>

</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">üìÅ Daftar File</h2>
    <h5 class="mb-4">Direktori Server : <span th:text="${path}"></span></h5>

    <form method="post" action="/files/upload" enctype="multipart/form-data" class="mb-4">    		 
        <div class="input-group">
            <input type="file" name="file" class="form-control" required>
            <button type="submit" class="btn btn-success">Upload</button>
        </div>
      
    </form>

    <table id="fileTable" class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Nama File</th>
                <th class="text-end">Ukuran</th>
                <th>Terakhir Diubah</th>
                <th class="text-center">Preview</th>
                <th class="text-center">Download</th>
                <th class="text-center">Hapus</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="file : ${files}">
                <td th:text="${file.name}"></td>
                <td class="text-end" th:text="${file.size}"></td>
                <td th:text="${file.lastModified}"></td>
			    <td class="actions">
                    <a th:href="@{'/files/preview/' + ${file.name}}" class="btn btn-sm btn-secondary">Preview</a>
			    </td>    
                
                <td class="text-center">
                    <a th:href="@{'/files/download/' + ${file.name}}" class="btn btn-sm btn-primary">Download</a>
                </td>
         
                 <td class="actions">
					<button class="btn btn-danger" th:attr="data-nama=${file.name}" onclick="deleteFile(this)">Hapus</button>
			     </td>
           
            </tr>
        </tbody>
    </table>

    <div class="mt-3">
        <a href="/logout" class="btn btn-outline-secondary">Logout</a>
        <br>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
    $(document).ready(function () {
        $('#fileTable').DataTable({
            pageLength: 10,
            lengthChange: false,
            language: {
                search: "Cari:",
                paginate: {
                    next: "Berikutnya",
                    previous: "Sebelumnya"
                },
                info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ file"
            }
        });
    });
</script>
</body>
</html>
